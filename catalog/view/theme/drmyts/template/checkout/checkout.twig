{{ header }}

{% import "drmyts/template/macro/macros.twig" as macros %}
<div id="checkout-checkout" class="container">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>
  {% if error_warning %}
      <div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
        <button type="button" class="close" data-dismiss="alert">&times;</button>
      </div>
  {% endif %}
  <div class="row">{{ column_left }}
    {% if column_left and column_right %}
    {% set class = 'col-sm-6' %}
    {% elseif column_left or column_right %}
    {% set class = 'col-sm-9' %}
    {% else %}
    {% set class = 'col-sm-12' %}
    {% endif %}
    <div id="content" class="{{ class }}">{{ content_top }}
      <h1>{{ heading_title }}</h1>
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">{{ text_checkout_option }}</h4>
          </div>
          <div class="panel-collapse collapse" id="collapse-checkout-option">
            <div class="panel-body"></div>
          </div>
        </div>
        {# {% if not logged and account != 'guest' %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">{{ text_checkout_account }}</h4>
          </div>
          <div class="panel-collapse collapse" id="collapse-payment-address">
            <div class="panel-body"></div>
          </div>
        </div>
        {% else %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">{{ text_checkout_payment_address }}</h4>
          </div>
          <div class="panel-collapse collapse" id="collapse-payment-address">
            <div class="panel-body"></div>
          </div>
        </div>
        {% endif %} #}
        {% if shipping_required %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">{{ text_checkout_shipping_address }}</h4>
          </div>
          <div class="panel-collapse collapse" id="collapse-shipping-address">
            <div class="panel-body"></div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">{{ text_checkout_shipping_method }}</h4>
          </div>
          <div class="panel-collapse collapse" id="collapse-shipping-method">
            <div class="panel-body"></div>
          </div>
        </div>
        {% endif %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">{{ text_checkout_payment_method }}</h4>
          </div>
          <div class="panel-collapse collapse" id="collapse-payment-method">
            <div class="panel-body"></div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">{{ text_checkout_confirm }}</h4>
          </div>
          <div class="panel-collapse collapse" id="collapse-checkout-confirm">
            <div class="panel-body"></div>
          </div>
        </div>
      </div>
      {{ content_bottom }}</div>
    {{ column_right }}</div>
</div>

<main id="content">
    {{ content_top }}
    <div class="page-title border--end">    
        <div class="container page-title__container">
            <h1 class="text--upp text--size_h2-mob text--size_h2-desk page-title__title m-0">{{ heading_title }}</h1>
        </div>
    </div>
    <section class="checkout-page"> 
        <div class="container checkout-page__container d-grid"> 
            <div class="checkout-page__col checkout-page__col--cart">
                <div class="checkout-page__cart checkout-cart"> 
                    <div class="checkout-cart__heading border--end">
                        <h2 class="checkout-cart__title text--size_h3-full m-0">{{ text_cart }} <span class="text--color_gray checkout-cart__count">(2)</span>
                        </h2>
                    </div>
                    <div class="checkout-cart__items flex-col"> 
                        <div class="cart-item checkout-cart__item cart-item--type_checkout d-flex border--end">
                            <div class="cart-item__img"> 
                                <picture> 
                                    <img class="contain-image" src="./assets/pics/search-item-1.jpg" alt="Comfort Zone" loading="lazy" width="56" height="56">
                                </picture>
                                <a class="cart-item__link abs inset wh-full" href="/">Comfort Zone</a>
                            </div>
                            <div class="cart-item__content"> 
                                <div class="cart-item__details flex-col">
                                    <a class="cart-item__title" href="/">Comfort Zone</a>
                                    <span class="cart-item__type">–°–∏—Ä–æ–≤–∞—Ç–∫–∞ –∑ –≥—ñ–∞–ª—É—Ä–æ–Ω–æ–≤–æ—é –∫–∏—Å–ª–æ—Ç–æ—é Hyaluronic Serum</span>
                                    <div class="product-price cart-item__price flex-row">
                                        <span class="product-price__full">1 711,5 ‚Ç¥</span>
                                    </div>
                                </div>
                                <div class="cart-item__footer flex-row-wrap j-between">
                                    <div class="quant-block cart-item__quant-block flex-row quant-block--sm"> 
                                        <button class="quant-block__btn btn flex-center btn--border_gray" type="button" data-operation="minus" disabled>
                                            {{ macros.svg('minus') }}
                                        </button>
                                        <input class="quant-block__input text--center" type="number" name="item_count" min="1" max="5" value="1">
                                        <button class="quant-block__btn btn flex-center btn--border_gray" type="button" data-operation="plus">
                                            {{ macros.svg('plus') }}
                                        </button>
                                    </div>
                                    <button class="btn flex-center icon cart-item__delete" type="button"> 
                                        {{ macros.svg('delete', '') }}
                                    </button>
                                 </div>
                            </div>
                        </div>
                        {# cart item end #}
                    </div>
                    {# checkout-cart__items #}
                </div>
                {# checkout-cart #}
                <div class="coupon-block checkout__coupon"> 
                    <div class="coupon-block__heading flex-row"> 
                        <div class="coupon-block__icon rel"> </div>
                        <div class="coupon-block__title text--color_red">–î–æ–¥–∞—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥ –∞–±–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç</div>
                    </div>
                    <div class="coupon-block__field custom-input custom-input--type_with-btn d-none"> 
                        <div class="custom-input__wrapper flex-row">
                            <input class="custom-input__input" type="text" name="coupon" placeholder="–í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥" required>
                            <button class="btn btn--full_black text--upp btn--size_M custom-input__btn" type="button">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
                        </div>
                        <div class="custom-input__error d-none">–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ–¥—ñ–π—Å–Ω–∏–π</div>
                    </div>
                </div>
                <div class="checkout-totals checkout__totals">
                    <div class="checkout-totals__vals border--start border--end"> 
                        <div class="checkout-totals__row flex-row-wrap j-between"> 
                            <p class="checkout-totals__val m-0">2 –∑–∞—Å–æ–±–∏</p>
                            <p class="checkout-totals__total m-0">1 840 ‚Ç¥</p>
                        </div>
                        <div class="checkout-totals__row flex-row-wrap j-between"> 
                            <p class="checkout-totals__val m-0">–ó–Ω–∏–∂–∫–∞</p>
                            <p class="checkout-totals__total m-0">-300 ‚Ç¥</p>
                        </div>
                        <div class="checkout-totals__row flex-row-wrap j-between"> 
                            <p class="checkout-totals__val m-0">–î–æ—Å—Ç–∞–≤–∫–∞</p>
                            <p class="checkout-totals__total m-0">–ó–∞ —Ç–∞—Ä–∏—Ñ–∞–º–∏ ¬´–ù–æ–≤–∞ –ü–æ—à—Ç–∞¬ª</p>
                        </div>
                    </div>
                    <div class="checkout-totals__delivery free-delivery"> 
                        <p class="free-delivery__heading">
                            <div class="icon free-delivery__icon"> 
                                {{ macros.svg('free-delivery')}}
                            </div>
                            <span class="m-0">–î–æ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ—ó –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–ª–∏—à–∏–ª–æ—Å—å </span>
                            <span class="free-delivery__price text--color_red"> 1 160 –≥—Ä–Ω.</span>
                        </p>
                        <div class="free-delivery__track w-full rel">   
                            <div class="free-delivery__track-inner wh-full abs inset bg--red" style="width: 50%"></div>
                        </div>
                        <span class="text--color_gray free-delivery__txt d-block">–ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è –ø–æ—à–∏—Ä—é—î—Ç—å—Å—è –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É –¥–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è —Ç–∞ –ø–æ—à—Ç–æ–º–∞—Ç—É.</span>
                    </div>
                    <div class="checkout-totals__row-total flex-row-wrap j-between"> 
                        <p class="checkout-totals__val m-0">–†–∞–∑–æ–º</p>
                        <div class="checkout-totals__final-price flex-row product-price product-price--sale">
                            <div class="product-price__full">2 140 ‚Ç¥</div>
                            <div class="product-price__sale">1 840 ‚Ç¥</div>
                        </div>
                    </div>
                </div>
            </div>
            {# checkout__col--cart #}
            <div class="checkout-page__col checkout-page__col--form"> 
                <div class="checkout-form checkout-page__form"> 
                    {% if not logged and account != 'guest' %}
                        <div class="checkout-form__tabs flex-row-wrap border--end" > 
                            <input type="radio" name="account" value="register" id="account_register" {% if account == 'register' %} checked="checked" {% endif %} />
                            <label for="account_register" class="btn checkout-form__tab-btn text--color_gray">{{ text_new_customer }}</label>
                            <input type="radio" name="account" value="guest" checked="checked" id="account_guest" {% if account == 'guest' %} checked="checked"{% endif %}/>
                            <label for="account_guest" class="btn checkout-form__tab-btn text--color_gray">{{ text_guest }}</label>
                            <input type="radio" name="account" value="login" checked="checked" id="account_login"/>
                            <label for="account_login" class="btn checkout-form__tab-btn text--color_gray">{{ text_returning_customer }}</label>
                        </div>
                    {% endif %}

                    <div class="checkout-form__tab"  id="checkout-guest-form">
                        <div class="checkout-form__group" id="collapse-payment-address"> 
                            <div class="checkout-form__group-heading border--end"> 
                                <h3 class="checkout-form__group-title text--size_h3-full m-0">{{ text_checkout_account }}</h3>
                            </div>
                            <div class="checkout-form__fields d-grid"> 
                                <div class="checkout-form__field custom-input">
                                    <input class="custom-input__input" type="text" name="user_name" placeholder="–í–∞—à–µ —ñ–º‚Äô—è" required>
                                    <div class="custom-input__error d-none">–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º‚Äô—è </div>
                                </div>
                                <div class="checkout-form__field custom-input">
                                    <input class="custom-input__input" type="text" name="user_surname" placeholder="–í–∞—à–µ –ø—Ä—ñ–∑–≤–∏—â–µ" required>
                                    <div class="custom-input__error d-none">–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î –ø—Ä—ñ–∑–≤–∏—â–µ</div>
                                </div>
                                <div class="checkout-form__field custom-input">
                                    <input class="custom-input__input" type="email" name="user_email" placeholder="E-mail" required>
                                    <div class="custom-input__error d-none">–í–≤–µ–¥—ñ—Ç—å —Å–≤—ñ–π E-mail</div>
                                </div>
                                <div class="checkout-form__field custom-input">
                                    <input class="custom-input__input" type="tel" name="user_phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
                                    <div class="custom-input__error d-none">–í–≤–µ–¥–∏ –Ω–æ–º–µ—Ä —É —Ñ–æ—Ä–º–∞—Ç—ñ +380 –•–• –•–•–• –•–• –•–•</div>
                                </div>
                            </div>
                            {# /.fileds #}
                            <div class="custom-checkbox checkout-form__checkbox flex-row">
                                <div class="custom-checkbox__wrapper rel"> 
                                    <input class="abs wh-full inset m-0" type="checkbox" name="recipient_me" checked id="recipient_me">
                                </div>
                                <label for="recipient_me">–Ø –û–¥–µ—Ä–∂—É–≤–∞—á</label>
                            </div>
                            <div class="checkout-form__fields d-grid"> 
                                <div class="checkout-form__field custom-input">
                                    <input class="custom-input__input" type="text" name="recipient_name" placeholder="–Ü–º‚Äô—è –æ–¥–µ—Ä–∂—É–≤–∞—á–∞" required>
                                    <div class="custom-input__error d-none">–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º‚Äô—è </div>
                                </div>
                                <div class="checkout-form__field custom-input">
                                    <input class="custom-input__input" type="text" name="recipient_surname" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –æ–¥–µ—Ä–∂—É–≤–∞—á–∞" required>
                                    <div class="custom-input__error d-none">–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î –ø—Ä—ñ–∑–≤–∏—â–µ</div>
                                </div>
                                <div class="checkout-form__field custom-input">
                                    <input class="custom-input__input" type="email" name="recipient_email" placeholder="E-mail –æ–¥–µ—Ä–∂—É–≤–∞—á–∞" required>
                                    <div class="custom-input__error d-none">–í–≤–µ–¥—ñ—Ç—å —Å–≤—ñ–π E-mail</div>
                                </div>
                                <div class="checkout-form__field custom-input">
                                    <input class="custom-input__input" type="tel" name="recipient_phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –æ–¥–µ—Ä–∂—É–≤–∞—á–∞" required>
                                    <div class="custom-input__error d-none">–í–≤–µ–¥–∏ –Ω–æ–º–µ—Ä —É —Ñ–æ—Ä–º–∞—Ç—ñ +380 –•–• –•–•–• –•–• –•–•</div>
                                </div>
                            </div>
                            {# /.checkout-form__fields #}
                            <div class="custom-checkbox checkout-form__checkbox flex-row">
                                <div class="custom-checkbox__wrapper rel"> 
                                    <input class="abs wh-full inset m-0" type="checkbox" name="secret_price" id="secret_price">
                                </div>
                                <label for="secret_price">–ó–∞–º–æ–≤–ª—è—é –¥–ª—è –ø–æ–¥–∞—Ä—É–Ω–∫–∞ ‚Äî –Ω–µ—Ö–∞–π —Ü—ñ–Ω–∞ –∑–∞–ª–∏—à–∏—Ç—å—Å—è —Ç–∞—î–º–Ω–∏—Ü–µ—é üéÅ</label>
                            </div>
                        </div>
                        {# /.checkout-form__group #}

                        <div class="checkout-form__group"> 
                            <div class="checkout-form__group-heading border--end"> 
                                <h3 class="checkout-form__group-title text--size_h3-full m-0">–î–æ—Å—Ç–∞–≤–∫–∞</h3>
                                <p class="checkout-form__group-subtitle text--color_gray">–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ –≤—ñ–¥ 3000 –≥—Ä–Ω.</p>
                            </div>
                            <div class="checkout-form__options flex-col"> 
                                <div class="custom-radio checkout-form__radio flex-row"> 
                                  <div class="custom-radio__wrapper rel"> 
                                    <input class="abs wh-full inset m-0" type="radio" name="delivery_type" value="np_department" checked id="np_department">
                                  </div>
                                  <label for="np_department">–î–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ù–æ–≤–æ—ó –ü–æ—à—Ç–∏</label>
                                </div>
                                <div class="custom-radio checkout-form__radio flex-row"> 
                                  <div class="custom-radio__wrapper rel"> 
                                    <input class="abs wh-full inset m-0" type="radio" name="delivery_type" value="np_poshtomat" id="np_poshtomat">
                                  </div>
                                  <label for="np_poshtomat">–ü–æ—à—Ç–æ–º–∞—Ç –ù–æ–≤–æ—ó –ü–æ—à—Ç–∏</label>
                                </div>
                                <div class="custom-radio checkout-form__radio flex-row"> 
                                  <div class="custom-radio__wrapper rel"> 
                                    <input class="abs wh-full inset m-0" type="radio" name="delivery_type" value="np_address" id="np_address">
                                  </div>
                                  <label for="np_address">–ö—É—Ä`—î—Ä –ù–æ–≤–æ—ó –ü–æ—à—Ç–∏</label>
                                </div>
                            </div>
                            <div class="checkout-form__destination">
                                <div class="checkout-form__select-wrapper w-full">
                                  <label class="checkout-form__select-label d-block" for="city"> –ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç</label>
                                  <div class="custom-select rel custom-select--type_checkout anim rel checkout-form__select"> 
                                    <div class="custom-select__heading flex-row j-between"> <span>–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç</span>
                                      <div class="icon icon--arrow custom-select__arrow anim">
                                        <svg role="presentation">
                                          <use href="./assets/svg/sprite.svg#arrow-down"></use>
                                        </svg>
                                      </div>
                                      <input type="hidden" name="city" required>
                                    </div>
                                    <div class="custom-select__dropdown z1 anim abs bg--white"> 
                                      <div class="custom-select__search custom-input custom-input--type_filter"> 
                                        <input class="custom-input__input" type="search" name="cities_search" placeholder="–ü–æ—à—É–∫...">
                                      </div>
                                      <ul class="custom-select__list">
                                        <li class="custom-select__option anim">–º. –ö–∏—ó–≤</li>
                                        <li class="custom-select__option anim">–º. –•–∞—Ä–∫—ñ–≤</li>
                                        <li class="custom-select__option anim">–º. –û–¥–µ—Å–∞</li>
                                        <li class="custom-select__option anim">–º. –î–Ω—ñ–ø—Ä–æ</li>
                                        <li class="custom-select__option anim">–º. –ó–∞–ø–æ—Ä—ñ–∂–∂—è</li>
                                      </ul>
                                    </div>
                                    <div class="custom-select__error d-none">–ü–æ–ª–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–µ –¥–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è</div>
                                  </div>
                                </div>
                                <div class="checkout-form__select-wrapper w-full"> 
                                  <label class="checkout-form__select-label d-block" for="city"> –í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</label>
                                  <div class="custom-select rel custom-select--type_checkout anim rel checkout-form__select">
                                    <div class="custom-select__heading flex-row j-between"> <span>–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</span>
                                      <div class="icon icon--arrow custom-select__arrow anim">
                                        <svg role="presentation">
                                          <use href="./assets/svg/sprite.svg#arrow-down"></use>
                                        </svg>
                                      </div>
                                      <input type="hidden" name="department" required>
                                    </div>
                                    <div class="custom-select__dropdown z1 anim abs bg--white"> 
                                      <div class="custom-select__search custom-input custom-input--type_filter"> 
                                        <input class="custom-input__input" type="search" name="cities_search" placeholder="–ü–æ—à—É–∫...">
                                      </div>
                                      <ul class="custom-select__list">
                                        <li class="custom-select__option anim">‚Ññ1: –≤—É–ª. –ü–∏—Ä–æ–≥—ñ–≤—Å—å–∫–∏–π —à–ª—è—Ö, 135</li>
                                        <li class="custom-select__option anim">‚Ññ5: –≤—É–ª. –§–µ–¥–æ—Ä–æ–≤–∞, 32 (–º–µ—Ç—Ä–æ –û–ª—ñ–º–ø—ñ–π—Å—å–∫–∞)</li>
                                        <li class="custom-select__option anim">‚Ññ11: –≤—É–ª. –ü–æ–ª—è—Ä–Ω–∞, 17–∞</li>
                                        <li class="custom-select__option anim">‚Ññ50: –ø—Ä–æ—Å–ø. –°—Ç–µ–ø–∞–Ω–∞ –ë–∞–Ω–¥–µ—Ä–∏, 23</li>
                                        <li class="custom-select__option anim">‚Ññ90: –≤—É–ª. –ì—Ä–∏–≥–æ—Ä–µ–Ω–∫–∞, 22/20</li>
                                        <li class="custom-select__option anim">‚Ññ215: –≤—É–ª. –õ—É–≥–æ–≤–∞, 12 (–¢–¶ –ö–∞—Ä–∞–≤–∞–Ω)</li>
                                      </ul>
                                    </div>
                                    <div class="custom-select__error d-none">–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</div>
                                  </div>
                                </div>
                            </div>
                            {# /.checkout-form__destination #}
                            <div class="checkout-form__field checkout-form__field--textarea custom-input custom-input--type_textarea rel custom-input--type_textarea-count"> 
                                <textarea class="custom-input__input" name="courier_comments" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä –∫—É—Ä`—î—Ä—É" maxlength="150"></textarea>
                                <div class="custom-input__count abs">0/150</div>
                            </div>
                        </div>
                        {# /.checkout-form__group #}
                        <div class="checkout-form__group"> 
                            <div class="checkout-form__group-heading border--end"> 
                                <h3 class="checkout-form__group-title text--size_h3-full m-0">–û–ø–ª–∞—Ç–∞</h3>
                            </div>
                            <div class="checkout-form__payment-options flex-row-wrap payment-btns"> 
                                <input class="payment-btns__input hidden" type="radio" name="payment_type" value="liqpay" id="payment_liqpay" checked>
                                <label class="payment-btns__label flex-center text--center anim btn--size_M text--upp btn--border_gray" for="payment_liqpay"> 
                                    {{ macros.svg('liqpay' ) }}
                                </label>
                                <input class="payment-btns__input hidden" type="radio" name="payment_type" value="google_pay" id="payment_google_pay">
                                <label class="payment-btns__label flex-center text--center anim btn--size_M text--upp btn--border_gray" for="payment_google_pay"> 
                                    {{ macros.svg('google-pay')}}
                                </label>
                                <input class="payment-btns__input hidden" type="radio" name="payment_type" value="mono_plata" id="payment_mono_plata">
                                <label class="payment-btns__label flex-center text--center anim btn--size_M text--upp btn--border_gray" for="payment_mono_plata"> 
                                    {{ macros.svg('mono-plata' )}}
                                </label>
                                <input class="payment-btns__input hidden" type="radio" name="payment_type" value="cash" id="payment_cash">
                                <label class="payment-btns__label flex-center text--center anim btn--size_M text--upp btn--border_gray" for="payment_cash">–ü–ª–∞—Ç—ñ–∂ –∑ –ø—ñ—Å–ª—è–ø–ª–∞—Ç–æ—é</label>
                            </div>
                        </div>
                        {# /.checkout-form__group #}
                    </div>

                    {# /.checkout-form__tab #}
                    <div class="checkout-form__tab d-none" id="checkout-login-form"></div>
                    {# /.checkout-form__tab #}
                </div>
                {# /.checkout-form #}
            </div>

            <div class="checkout-page__comment checkout-comment"> 
                <button class="btn flex-row checkout-comment__toggler text--upp" type="button"> 
                    <div class="icon checkout-comment__icon"> 
                        {{ macros.svg('checkout-comment', '')}}
                    </div>
                    <span>–ö–æ–º–µ–Ω—Ç–∞—Ä –¥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
                </button>
                <div class="checkout-comment__body d-none">
                    <div class="checkout-comment_field custom-input custom-input--type_textarea rel custom-input--type_textarea-count"> 
                        <textarea class="custom-input__input" name="order_comments" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä –¥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è" maxlength="500"></textarea>
                        <div class="custom-input__count abs">0/500</div>
                    </div>
                </div>
            </div>
            {# /.checkout-comment #}
            <button class="btn btn--theme btn--theme_accent text--upp btn--size_M checkout-page__submit" type="submit" disabled> –û–ü–õ–ê–¢–ò–¢–ò –ß–ï–†–ï–ó GOOGLE PAY</button>
            <div class="custom-checkbox checkout-page__checkbox flex-row custom-checkbox--red">
                <div class="custom-checkbox__wrapper rel"> 
                    <input class="abs wh-full inset m-0" type="checkbox" name="agreement" required id="agreement">
                </div>
                <label for="agreement">–Ø –ø–æ–≥–æ–¥–∂—É—é—Å—å –∑ <a href="/">—É–º–æ–≤–∞–º–∏ –æ—Ñ–µ—Ä—Ç–∏</a> —Ç–∞  <a href="/">–ø–æ–ª—ñ—Ç–∏–∫–∏ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</a> </label>
            </div>
        </div>
    </section>
</main>


<script type="text/javascript"><!--

// Toggle register MODES
const classes = {
    activeClass: 'active',
    hiddenClass: 'd-none',
}
document.addEventListener('change', function(event) {

    if (event.target && event.target.name === 'account') {
        const input = event.target;
        const value = input.value;
        const registerTab = document.getElementById('checkout-guest-form');
        const loginTab = document.getElementById('checkout-login-form');
        const isLogin = input.value === 'login';

        if (isLogin) {
            loginTab.classList.remove(classes.hiddenClass);
            registerTab.classList.add(classes.hiddenClass);
        } else {
            const url = 'index.php?route=checkout/' + value;

            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error(response.statusText);
                    return response.text();
                })
                .then(html => {
                    // 1. –û—á–∏—â—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –ø–æ–º–∏–ª–∫–∏
                    document.querySelectorAll('.alert-dismissible, .text-danger').forEach(el => el.remove());
                    document.querySelectorAll('.form-group').forEach(el => el.classList.remove('has-error'));

                    const collapseAddress = document.getElementById('collapse-payment-address');
                    if (collapseAddress) {
                        collapseAddress.innerHTML = html;
                    }
                })
                .catch(error => {
                    alert('Error: ' + error.message);
                    console.error(error);
                })
                .finally(() => {
                    loginTab.classList.add(classes.hiddenClass);
                    registerTab.classList.remove(classes.hiddenClass) 
                });
        }
    }
});

// 1 Check if user is logged in or NOT
document.addEventListener('DOMContentLoaded', function() {
    {% if not logged %}
        const url = 'index.php?route=checkout/login';
        const targetId = 'checkout-login-form';
        // const titleText = '{{ text_checkout_option }}';
    {% else %}
        const url = 'index.php?route=checkout/payment_address';
        const targetId = 'collapse-payment-address';
        // const titleText = '{{ text_checkout_payment_address }}';
    {% endif %}

    fetch(url)
        .then(response => {
            if (!response.ok) throw new Error(response.statusText);
            return response.text();
        })
        .then(html => {
            {% if not logged %}
                const container = document.getElementById(targetId);
                if (!container) return;

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const loginForm = doc.querySelector('.sign-form__form');

                if (loginForm && container) container.appendChild(loginForm);

            {% endif %}

            // // –û–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫
            // const panelTitle = container.closest('.panel').querySelector('.panel-heading .panel-title');
            // if (panelTitle) {
            //     panelTitle.innerHTML = `<a href="#${targetId}" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">${titleText} <i class="fa fa-caret-down"></i></a>`;
            // }

            // // –Ü–º—ñ—Ç—É—î–º–æ –∫–ª—ñ–∫ –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è
            // const toggleLink = document.querySelector(`a[href="#${targetId}"]`);
            // if (toggleLink) {
            //     toggleLink.click();
            // }
        })
        .catch(error => {
            alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É: ' + error.message);
            console.error(error);
        });
});

// Switch between REGISTER OR GUEST CHECKOUT
document.addEventListener('click', function(event) {

    if (event.target && event.target.id === 'button-account') {
        
        const checkedAccount = document.querySelector('input[name="account"]:checked');
        if (!checkedAccount) return;

        const accountValue = checkedAccount.value;
        const url = 'index.php?route=checkout/' + accountValue;


        fetch(url)
            .then(response => {
                if (!response.ok) throw new Error(response.statusText);
                return response.text();
            })
            .then(html => {
                // 1. –û—á–∏—â—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –ø–æ–º–∏–ª–∫–∏
                document.querySelectorAll('.alert-dismissible, .text-danger').forEach(el => el.remove());
                document.querySelectorAll('.form-group').forEach(el => el.classList.remove('has-error'));

                // 2. –û–Ω–æ–≤–ª—é—î–º–æ –≤–º—ñ—Å—Ç –ø–∞–Ω–µ–ª—ñ
                const collapseAddress = document.getElementById('collapse-payment-address');
                if (collapseAddress) {
                    const panelBody = collapseAddress.querySelector('.panel-body');
                    if (panelBody) panelBody.innerHTML = html;

                    // 3. –û–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É –∞–∫–∞—É–Ω—Ç—É
                    const panelTitle = collapseAddress.closest('.panel').querySelector('.panel-heading .panel-title');
                    if (panelTitle) {
                        const titleText = (accountValue === 'register') 
                            ? '{{ text_checkout_account }}' 
                            : '{{ text_checkout_payment_address }}';
                        
                        panelTitle.innerHTML = `<a href="#collapse-payment-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">${titleText} <i class="fa fa-caret-down"></i></a>`;
                    }

                    // 4. –Ü–º—ñ—Ç—É—î–º–æ –∫–ª—ñ–∫ –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è (Bootstrap 3/4 JS –ø—ñ–¥—Ö–æ–ø–∏—Ç—å —Ü–µ)
                    const toggleLink = document.querySelector('a[href="#collapse-payment-address"]');
                    if (toggleLink) toggleLink.click();
                }
            })
            .catch(error => {
                alert('Error: ' + error.message);
                console.error(error);
            })
            .finally(() => {
                // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤ —Ä–æ–±–æ—á–∏–π —Å—Ç–∞–Ω
                btn.disabled = false;
            });
    }
});
// Login
$(document).delegate('#button-login', 'click', function() {
    $.ajax({
        url: 'index.php?route=checkout/login/save',
        type: 'post',
        data: $('#collapse-checkout-option :input'),
        dataType: 'json',
        // beforeSend: function() {
        // 	$('#button-login').button('loading');
		// },
        // complete: function() {
        //     $('#button-login').button('reset');
        // },
        success: function(json) {
            $('.alert-dismissible, .text-danger').remove();
            $('.form-group').removeClass('has-error');

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                $('#collapse-checkout-option .panel-body').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');

				// Highlight any found errors
				$('input[name=\'email\']').parent().addClass('has-error');
				$('input[name=\'password\']').parent().addClass('has-error');
		   }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

// Register
$(document).delegate('#button-register', 'click', function() {
    $.ajax({
        url: 'index.php?route=checkout/register/save',
        type: 'post',
        data: $('#collapse-payment-address input[type=\'text\'], #collapse-payment-address input[type=\'date\'], #collapse-payment-address input[type=\'datetime-local\'], #collapse-payment-address input[type=\'time\'], #collapse-payment-address input[type=\'password\'], #collapse-payment-address input[type=\'hidden\'], #collapse-payment-address input[type=\'checkbox\']:checked, #collapse-payment-address input[type=\'radio\']:checked, #collapse-payment-address textarea, #collapse-payment-address select'),
        dataType: 'json',
        // beforeSend: function() {
		// 	$('#button-register').button('loading');
		// },
        success: function(json) {
            $('.alert-dismissible, .text-danger').remove();
            $('.form-group').removeClass('has-error');

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                $('#button-register').button('reset');

                if (json['error']['warning']) {
                    $('#collapse-payment-address .panel-body').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }

				for (i in json['error']) {
					var element = $('#input-payment-' + i.replace('_', '-'));

					if ($(element).parent().hasClass('input-group')) {
						$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
					} else {
						$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
					}
				}

				// Highlight any found errors
				$('.text-danger').parent().addClass('has-error');
            } else {
                {% if shipping_required %}
                var shipping_address = $('#payment-address input[name=\'shipping_address\']:checked').prop('value');

                if (shipping_address) {
                    $.ajax({
                        url: 'index.php?route=checkout/shipping_method',
                        dataType: 'html',
                        success: function(html) {
							// Add the shipping address
                            $.ajax({
                                url: 'index.php?route=checkout/shipping_address',
                                dataType: 'html',
                                success: function(html) {
                                    $('#collapse-shipping-address .panel-body').html(html);

									$('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="fa fa-caret-down"></i></a>');
                                },
                                error: function(xhr, ajaxOptions, thrownError) {
                                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                                }
                            });

							$('#collapse-shipping-method .panel-body').html(html);

							$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_method }} <i class="fa fa-caret-down"></i></a>');

   							$('a[href=\'#collapse-shipping-method\']').trigger('click');

							$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_shipping_method }}');
							$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
							$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
                } else {
                    $.ajax({
                        url: 'index.php?route=checkout/shipping_address',
                        dataType: 'html',
                        success: function(html) {
                            $('#collapse-shipping-address .panel-body').html(html);

							$('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="fa fa-caret-down"></i></a>');

							$('a[href=\'#collapse-shipping-address\']').trigger('click');

							$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_shipping_method }}');
							$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
							$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
                }
                {% else %}
                $.ajax({
                    url: 'index.php?route=checkout/payment_method',
                    dataType: 'html',
                    success: function(html) {
                        $('#collapse-payment-method .panel-body').html(html);

						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_method }} <i class="fa fa-caret-down"></i></a>');

						$('a[href=\'#collapse-payment-method\']').trigger('click');

						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
                {% endif %}

                $.ajax({
                    url: 'index.php?route=checkout/payment_address',
                    dataType: 'html',
                    complete: function() {
                        $('#button-register').button('reset');
                    },
                    success: function(html) {
                        $('#collapse-payment-address .panel-body').html(html);

						$('#collapse-payment-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_address }} <i class="fa fa-caret-down"></i></a>');
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

// Payment Address
$(document).delegate('#button-payment-address', 'click', function() {
    $.ajax({
        url: 'index.php?route=checkout/payment_address/save',
        type: 'post',
        data: $('#collapse-payment-address input[type=\'text\'], #collapse-payment-address input[type=\'date\'], #collapse-payment-address input[type=\'datetime-local\'], #collapse-payment-address input[type=\'time\'], #collapse-payment-address input[type=\'password\'], #collapse-payment-address input[type=\'checkbox\']:checked, #collapse-payment-address input[type=\'radio\']:checked, #collapse-payment-address input[type=\'hidden\'], #collapse-payment-address textarea, #collapse-payment-address select'),
        dataType: 'json',
        // beforeSend: function() {
        // 	$('#button-payment-address').button('loading');
		// },
        // complete: function() {
		// 	$('#button-payment-address').button('reset');
        // },
        success: function(json) {
            $('.alert-dismissible, .text-danger').remove();
			$('.form-group').removeClass('has-error');

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                if (json['error']['warning']) {
                    $('#collapse-payment-address .panel-body').prepend('<div class="alert alert-warning alert-dismissible">' + json['error']['warning'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }

				for (i in json['error']) {
					var element = $('#input-payment-' + i.replace('_', '-'));

					if ($(element).parent().hasClass('input-group')) {
						$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
					} else {
						$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
					}
				}

				// Highlight any found errors
				$('.text-danger').parent().parent().addClass('has-error');
            } else {
                {% if shipping_required %}
                $.ajax({
                    url: 'index.php?route=checkout/shipping_address',
                    dataType: 'html',
                    success: function(html) {
                        $('#collapse-shipping-address .panel-body').html(html);

						$('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="fa fa-caret-down"></i></a>');

						$('a[href=\'#collapse-shipping-address\']').trigger('click');

						$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_shipping_method }}');
						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                }).done(function() {
					$.ajax({
						url: 'index.php?route=checkout/payment_address',
						dataType: 'html',
						success: function(html) {
							$('#collapse-payment-address .panel-body').html(html);
						},
						error: function(xhr, ajaxOptions, thrownError) {
							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						}
					});
				});
                {% else %}
                $.ajax({
                    url: 'index.php?route=checkout/payment_method',
                    dataType: 'html',
                    success: function(html) {
                        $('#collapse-payment-method .panel-body').html(html);

						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_method }} <i class="fa fa-caret-down"></i></a>');

						$('a[href=\'#collapse-payment-method\']').trigger('click');

						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                }).done(function() {
					$.ajax({
						url: 'index.php?route=checkout/payment_address',
						dataType: 'html',
						success: function(html) {
							$('#collapse-payment-address .panel-body').html(html);
						},
						error: function(xhr, ajaxOptions, thrownError) {
							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						}
					});				
				});
                {% endif %}
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

// Shipping Address
$(document).delegate('#button-shipping-address', 'click', function() {
    $.ajax({
        url: 'index.php?route=checkout/shipping_address/save',
        type: 'post',
        data: $('#collapse-shipping-address input[type=\'text\'], #collapse-shipping-address input[type=\'date\'], #collapse-shipping-address input[type=\'datetime-local\'], #collapse-shipping-address input[type=\'time\'], #collapse-shipping-address input[type=\'password\'], #collapse-shipping-address input[type=\'checkbox\']:checked, #collapse-shipping-address input[type=\'radio\']:checked, #collapse-shipping-address textarea, #collapse-shipping-address select'),
        dataType: 'json',
        // beforeSend: function() {
		// 	$('#button-shipping-address').button('loading');
	    // },
        success: function(json) {
            $('.alert-dismissible, .text-danger').remove();
			$('.form-group').removeClass('has-error');

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                $('#button-shipping-address').button('reset');

                if (json['error']['warning']) {
                    $('#collapse-shipping-address .panel-body').prepend('<div class="alert alert-warning alert-dismissible">' + json['error']['warning'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }

				for (i in json['error']) {
					var element = $('#input-shipping-' + i.replace('_', '-'));

					if ($(element).parent().hasClass('input-group')) {
						$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
					} else {
						$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
					}
				}

				// Highlight any found errors
				$('.text-danger').parent().parent().addClass('has-error');
            } else {
                $.ajax({
                    url: 'index.php?route=checkout/shipping_method',
                    dataType: 'html',
                    complete: function() {
                        $('#button-shipping-address').button('reset');
                    },
                    success: function(html) {
                        $('#collapse-shipping-method .panel-body').html(html);

						$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_method }} <i class="fa fa-caret-down"></i></a>');

						$('a[href=\'#collapse-shipping-method\']').trigger('click');

						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
						
                        $.ajax({
                            url: 'index.php?route=checkout/shipping_address',
                            dataType: 'html',
                            success: function(html) {
                                $('#collapse-shipping-address .panel-body').html(html);
                            },
                            error: function(xhr, ajaxOptions, thrownError) {
                                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                            }
                        });
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                }).done(function() {
					$.ajax({
						url: 'index.php?route=checkout/payment_address',
						dataType: 'html',
						success: function(html) {
							$('#collapse-payment-address .panel-body').html(html);
						},
						error: function(xhr, ajaxOptions, thrownError) {
							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						}
					});
				});
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

// Guest
$(document).delegate('#button-guest', 'click', function() {
    $.ajax({
        url: 'index.php?route=checkout/guest/save',
        type: 'post',
        data: $('#collapse-payment-address input[type=\'text\'], #collapse-payment-address input[type=\'date\'], #collapse-payment-address input[type=\'datetime-local\'], #collapse-payment-address input[type=\'time\'], #collapse-payment-address input[type=\'checkbox\']:checked, #collapse-payment-address input[type=\'radio\']:checked, #collapse-payment-address input[type=\'hidden\'], #collapse-payment-address textarea, #collapse-payment-address select'),
        dataType: 'json',
        // beforeSend: function() {
       	// 	$('#button-guest').button('loading');
	    // },
        success: function(json) {
            $('.alert-dismissible, .text-danger').remove();
			$('.form-group').removeClass('has-error');

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                $('#button-guest').button('reset');

                if (json['error']['warning']) {
                    $('#collapse-payment-address').prepend('<div class="alert alert-warning alert-dismissible">' + json['error']['warning'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }

				for (i in json['error']) {
					var element = $('#input-payment-' + i.replace('_', '-'));

					if ($(element).parent().hasClass('input-group')) {
						$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
					} else {
						$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
					}
				}

				// Highlight any found errors
				$('.text-danger').parent().addClass('has-error');
            } else {
                {% if shipping_required %}
                var shipping_address = $('#collapse-payment-address input[name=\'shipping_address\']:checked').prop('value');

                if (shipping_address) {
                    $.ajax({
                        url: 'index.php?route=checkout/shipping_method',
                        dataType: 'html',
                        complete: function() {
                            $('#button-guest').button('reset');
                        },
                        success: function(html) {
							// Add the shipping address
                            $.ajax({
                                url: 'index.php?route=checkout/guest_shipping',
                                dataType: 'html',
                                success: function(html) {
                                    $('#collapse-shipping-address .panel-body').html(html);

									$('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="fa fa-caret-down"></i></a>');
                                },
                                error: function(xhr, ajaxOptions, thrownError) {
                                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                                }
                            });

						    $('#collapse-shipping-method .panel-body').html(html);

							$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_method }} <i class="fa fa-caret-down"></i></a>');

							$('a[href=\'#collapse-shipping-method\']').trigger('click');

							$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
							$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
                } else {
                    $.ajax({
                        url: 'index.php?route=checkout/guest_shipping',
                        dataType: 'html',
                        complete: function() {
                            $('#button-guest').button('reset');
                        },
                        success: function(html) {
                            $('#collapse-shipping-address .panel-body').html(html);

							$('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="fa fa-caret-down"></i></a>');

							$('a[href=\'#collapse-shipping-address\']').trigger('click');

							$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_shipping_method }}');
							$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
							$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
                }
                {% else %}
                $.ajax({
                    url: 'index.php?route=checkout/payment_method',
                    dataType: 'html',
                    complete: function() {
                        $('#button-guest').button('reset');
                    },
                    success: function(html) {
                        $('#collapse-payment-method .panel-body').html(html);

						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_method }} <i class="fa fa-caret-down"></i></a>');

						$('a[href=\'#collapse-payment-method\']').trigger('click');

						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
                {% endif %}
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

// Guest Shipping
$(document).delegate('#button-guest-shipping', 'click', function() {
    $.ajax({
        url: 'index.php?route=checkout/guest_shipping/save',
        type: 'post',
        data: $('#collapse-shipping-address input[type=\'text\'], #collapse-shipping-address input[type=\'date\'], #collapse-shipping-address input[type=\'datetime-local\'], #collapse-shipping-address input[type=\'time\'], #collapse-shipping-address input[type=\'password\'], #collapse-shipping-address input[type=\'checkbox\']:checked, #collapse-shipping-address input[type=\'radio\']:checked, #collapse-shipping-address textarea, #collapse-shipping-address select'),
        dataType: 'json',
        // beforeSend: function() {
        // 	$('#button-guest-shipping').button('loading');
		// },
        success: function(json) {
            $('.alert-dismissible, .text-danger').remove();
			$('.form-group').removeClass('has-error');

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                $('#button-guest-shipping').button('reset');

                if (json['error']['warning']) {
                    $('#collapse-shipping-address .panel-body').prepend('<div class="alert alert-danger alert-dismissible">' + json['error']['warning'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }

				for (i in json['error']) {
					var element = $('#input-shipping-' + i.replace('_', '-'));

					if ($(element).parent().hasClass('input-group')) {
						$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
					} else {
						$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
					}
				}

				// Highlight any found errors
				$('.text-danger').parent().addClass('has-error');
            } else {
                $.ajax({
                    url: 'index.php?route=checkout/shipping_method',
                    dataType: 'html',
                    complete: function() {
                        $('#button-guest-shipping').button('reset');
                    },
                    success: function(html) {
                        $('#collapse-shipping-method .panel-body').html(html);

						$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_method }} <i class="fa fa-caret-down"></i>');

						$('a[href=\'#collapse-shipping-method\']').trigger('click');

						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

$(document).delegate('#button-shipping-method', 'click', function() {
    $.ajax({
        url: 'index.php?route=checkout/shipping_method/save',
        type: 'post',
        data: $('#collapse-shipping-method input[type=\'radio\']:checked, #collapse-shipping-method textarea'),
        dataType: 'json',
        // beforeSend: function() {
        // 	$('#button-shipping-method').button('loading');
		// },
        success: function(json) {
            $('.alert-dismissible, .text-danger').remove();

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                $('#button-shipping-method').button('reset');

                if (json['error']['warning']) {
                    $('#collapse-shipping-method .panel-body').prepend('<div class="alert alert-danger alert-dismissible">' + json['error']['warning'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }
            } else {
                $.ajax({
                    url: 'index.php?route=checkout/payment_method',
                    dataType: 'html',
                    complete: function() {
                        $('#button-shipping-method').button('reset');
                    },
                    success: function(html) {
                        $('#collapse-payment-method .panel-body').html(html);

						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_method }} <i class="fa fa-caret-down"></i></a>');

						$('a[href=\'#collapse-payment-method\']').trigger('click');

						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

$(document).delegate('#button-payment-method', 'click', function() {
    $.ajax({
        url: 'index.php?route=checkout/payment_method/save',
        type: 'post',
        data: $('#collapse-payment-method input[type=\'radio\']:checked, #collapse-payment-method input[type=\'checkbox\']:checked, #collapse-payment-method textarea'),
        dataType: 'json',
        // beforeSend: function() {
        //  	$('#button-payment-method').button('loading');
		// },
        success: function(json) {
            $('.alert-dismissible, .text-danger').remove();

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                $('#button-payment-method').button('reset');
                
                if (json['error']['warning']) {
                    $('#collapse-payment-method .panel-body').prepend('<div class="alert alert-danger alert-dismissible">' + json['error']['warning'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }
            } else {
                $.ajax({
                    url: 'index.php?route=checkout/confirm',
                    dataType: 'html',
                    complete: function() {
                        $('#button-payment-method').button('reset');
                    },
                    success: function(html) {
                        $('#collapse-checkout-confirm .panel-body').html(html);

						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('<a href="#collapse-checkout-confirm" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_confirm }} <i class="fa fa-caret-down"></i></a>');

						$('a[href=\'#collapse-checkout-confirm\']').trigger('click');
					},
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});
//--></script>
{{ footer }}